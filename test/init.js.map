{"version":3,"file":"init.js","sources":["../src/Dre_Errors.mjs","../src/model/DreRegionBehaviorBaseType.mjs","../src/model/DreRegionBehaviorItemType.mjs","../src/init.mjs"],"sourcesContent":["import { MODULE_ID } from \"./constants.mjs\"\n\nclass DreErrorBase extends Error {\n    constructor(ErrorId=\"DRE_ERROR\",message,...params) {\n        super(message,params)\n        this.name = `${MODULE_ID}.${ErrorId}`\n    }\n}\n\nexport class InvalidFunctionArgument extends DreErrorBase {\n    static ID = \"INVALID_FUNC_ARG\"\n    static BASE_MSG = \"An argument provided to the function was invalid.\"\n    constructor(argName,argValue,reason,...params) {\n        super(\n            InvalidFunctionArgument.ID,\n            `${InvalidFunctionArgument.BASE_MSG} reason: ${reason} param: ${argName}, value: ${argValue}`,\n            params\n        )\n    }\n}","import {BEHAVIOR_PREFIX} from '../constants.mjs'\nimport {InvalidFunctionArgument} from '../Dre_Errors.mjs'\nconst { RegionBehaviorType } = foundry.data.regionBehaviors;\nconst { SetField, StringField, DocumentUUIDField } = foundry.data.fields;\n\n/**\n * @typedef {import(\"./foundryTypeDefs.mjs\").DataFieldOptions} DataFieldOptions\n * @typedef {import(\"./foundryTypeDefs.mjs\").SetField} SetField\n * @typedef {import(\"./foundryTypeDefs.mjs\").StringField} StringField\n */\n\n/**\n * The Base DRE Behavior for all DRE Behaviors.\n * \n * T\n * @abstract\n * @property {string} uuid           The Macro UUID.\n */\nexport default class DreRegionBehaviorBaseType extends RegionBehaviorType {\n  static BEHAVIOR_ID = 'BASE'\n  /** @override */\n  static LOCALIZATION_PREFIXES = [`${BEHAVIOR_PREFIX}.${this.BEHAVIOR_ID}`];\n  static events = {}\n  static EFFECT_SOURCE_CHOICES = [\n    \"ACTOR\",\n    \"ENVIRONMENT\",\n    \"PLACEABLE_OBJECT\"\n  ]\n\n  static defineSchema() {\n   \n    //Apparently in JS you inherit static functions too\n    return {\n      events : this._createEventsField()\n    }\n  }\n\n  // static _createEventsField() {\n  //   return super._createEventsField();\n  // }\n\n  /** @override */\n  async _handleRegionEvent(event) {\n    console.debug(`${LOCALIZATION_PREFIXES} _handleRegionEvent`,event);\n  }\n\n/**\n * \n * @param {Array<string>} optsArray A string array containing the options id's for the field\n * @param {string} localizationFieldPath The fully qualified localization path for this field that will appear before the choice keys.\n * @param {boolean} isRequired True if the field should be required. Overrides related key in fieldOptions if provided. Default: True\n * @param {bigint} defaultOptIndex The index of the default option contained in the array optsArray. Overrides related key in fieldOptions if provided.\n * @param {DataFieldOptions} fieldOptions Extra options. If a key contianed has an associated arg in this function which was explicitly passed it will override the related value in this object.\n * @return {StringField} A SetField containing the options required\n * @throws {InvalidFunctionArgument}\n */\n  static _createOptionsField(optsArray,localizationFieldPath,isRequired,defaultOptIndex,fieldOptions) {\n    if(!optsArray instanceof Array) {\n      throw new InvalidFunctionArgument(\"optsArray\",optsArray,\"Must be an instance of Array<T>.\");\n    }\n    else if(optsArray.length < 1) {\n      throw new InvalidFunctionArgument(\"optsArray\",optsArray,\"optsArray must have at least one element.\");\n    }\n    else if(defaultOptIndex && defaultOptIndex > -1 && optsArray.length <= defaultOptIndex) {\n      throw new InvalidFunctionArgument(\"defaultOptIndex\",defaultOptIndex,`Index ${defaultOptIndex} is not in optsArray.`)\n    }\n    else if(!localizationFieldPath) {\n      throw new InvalidFunctionArgument(\"localizationFieldPath\",localizationFieldPath,\"Must be a valid localization path.\")\n    }\n\n    let options = {\n      'required' : true,\n      'nullable' : false,\n      'initial' : optsArray[0]\n    }\n\n    let explicitOptions = {};\n\n    if(isRequired) {\n      explicitOptions['required'] = isRequired\n    }\n\n    if(defaultOptIndex) {\n      explicitOptions['initial'] = optsArray[defaultOptIndex]\n    }\n  \n    if(fieldOptions && fieldOptions.hasOwnProperty('choices')) {\n      console.warn(\"Choices key found on fieldOptions. Deleting choices and regenerating with given params.\")\n      delete fieldOptions.choices;\n    }\n\n    Object.assign(options,explicitOptions,fieldOptions)\n    options['choices'] = {}\n    \n    //Populate map of options to localization labels that represent them\n    for(const option of optsArray) {\n      options.choices[option] = `${localizationFieldPath}.${option}.label`\n    }\n    console.log(\"setField options: \",options)\n    return new StringField(options)\n  }\n}","import {BEHAVIOR_PREFIX} from '../constants.mjs'\nimport DreRegionBehaviorBaseType from './DreRegionBehaviorBaseType.mjs';\nconst { RegionBehaviorType } = foundry.data.regionBehaviors;\nconst { SetField, StringField, DocumentUUIDField } = foundry.data.fields;\nconst REGION_EVENTS = foundry.CONST.REGION_EVENTS\n\n\n/**\n * A Behavior that uses an item as the source of an effect. \n * \n * Targets will be affected regardless of item's range because\n * we will assume that any target in the region is valid unless\n * filtered out.\n *\n * @property {string} uuid           The Macro UUID.\n */\nexport default class DreRegionBehaviorItemType extends DreRegionBehaviorBaseType {\n  static BEHAVIOR_ID = 'ITEM'\n  /** @override */\n  static LOCALIZATION_PREFIXES = [`${BEHAVIOR_PREFIX}.${this.BEHAVIOR_ID}`];\n  static events = {}\n  static  ITEM_OPTION_CHOICES = [\n    \"USE_ITEM\",\n    \"USE_ITEM_COPY\"\n  ]\n\n\n  /** @override */\n  static defineSchema() {\n    const schOut = {\n      itemOpt : this._createOptionsField(this.ITEM_OPTION_CHOICES,`${this.LOCALIZATION_PREFIXES}.FIELDS.itemOpt`,true,0),\n      effectSource : this._createOptionsField(this.EFFECT_SOURCE_CHOICES,`${this.LOCALIZATION_PREFIXES}.FIELDS.effectSource`,true,0),\n      events: this._createEventsField(),\n      item: new DocumentUUIDField(\n        {\n          type: \"Item\",\n          validate : this.validateItem\n        }\n      )\n    };\n    console.log(`Schema Defined for ${DreRegionBehaviorItemType.LOCALIZATION_PREFIXES}:`,schOut)\n    return schOut;\n  }\n\n  /**\n   * Validates the item given against a criteria.\n   * @param {uuid} ItemUuid \n   * @returns {boolean} True if item is valid.\n   */\n  static validateItem(ItemUuid) {\n    console.log(\"Item Validator: \",ItemUuid);\n    return true\n  }\n\n  /* ---------------------------------------- */\n\n  /** @override */\n  async _handleRegionEvent(event) {\n    console.debug(`${LOCALIZATION_PREFIXES} _handleRegionEvent`,event);\n    if ( !this.uuid ) return;\n    const macro = await fromUuid(this.uuid);\n    if ( !(macro instanceof Macro) ) {\n      console.error(`${this.uuid} does not exist`);\n      return;\n    }\n    await macro.execute({scene: this.scene, region: this.region, behavior: this.behavior, event, actor: null, token: null});\n  }\n}","import {MODULE_ID} from \"./constants.mjs\";\nimport TestApp from './sheets/TestApp.mjs'\nimport DreRegionBehaviorBaseType from \"./model/DreRegionBehaviorBaseType.mjs\";\nimport DreRegionBehaviorItemType from \"./model/DreRegionBehaviorItemType.mjs\";\n\nconsole.log(\"Initilizing module: \",MODULE_ID);\n\nHooks.once(\"init\",() => {\n    console.log(\"Init code for \",MODULE_ID);\n    console.log(\"init this\",this)\n    console.log(\"config\",CONFIG)\n    console.log(\"check object to assign\",CONFIG?.RegionBehavior?.dataModels)\n    \n    //The keys of this field must match the TYPES key assigned to the class for localization to work on dialogue windows\n    Object.assign(CONFIG.RegionBehavior.dataModels,{\n        [`${MODULE_ID}.DreRegionBehaviorItemType`] : DreRegionBehaviorItemType\n    })\n});\n\nHooks.once(\"ready\",() => {\n    console.log(\"Ready code for the module \",MODULE_ID);\n    const testApp = new TestApp();\n    console.log(\"check object to assign\",CONFIG?.RegionBehavior?.dataModels)\n    testApp.render(true);\n});\n\nHooks.on('renderRegionBehaviorConfig',(app,html,data) =>{\n    if(!app.document.type.includes(`${MODULE_ID}.DreRegionBehavior`)) {\n        return;\n    }\n    console.log(\"DRE region behavior config rendered!\",app,html,data);\n    //todo: bind the instance listeners to the form. This should be delegated to a class that understands region behavior config with some type specific validation\n});"],"names":["DreErrorBase","ErrorId","message","params","MODULE_ID","_InvalidFunctionArgument","argName","argValue","reason","__publicField","InvalidFunctionArgument","RegionBehaviorType","SetField","StringField","DocumentUUIDField","_DreRegionBehaviorBaseType","event","optsArray","localizationFieldPath","isRequired","defaultOptIndex","fieldOptions","options","explicitOptions","option","BEHAVIOR_PREFIX","DreRegionBehaviorBaseType","_DreRegionBehaviorItemType","schOut","ItemUuid","macro","DreRegionBehaviorItemType","this","_a","testApp","TestApp","app","html","data"],"mappings":"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"}